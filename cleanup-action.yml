name: 'PSE Security Proxy Cleanup'
description: 'Cleans up the PSE Security Proxy and sends the end signal'
author: 'InvisiRisk'
branding:
  icon: 'shield'
  color: 'blue'
inputs:
  api_url:
    description: 'URL of the InvisiRisk API'
    required: true
  app_token:
    description: 'Authentication token for the InvisiRisk API'
    required: true
  portal_url:
    description: 'URL of the InvisiRisk Portal'
    required: true
  scan_id:
    description: 'Scan ID from the setup step'
    required: true
  debug:
    description: 'Enable debug mode for verbose logging'
    required: false
    default: 'false'
  test_mode:
    description: 'Enable test mode to bypass API calls and container setup for testing'
    required: false
    default: 'false'

runs:
  using: "composite"
  steps:
    - name: Cleanup PSE Proxy
      shell: bash
      run: ${{ github.action_path }}/cleanup.sh
      env:
        API_URL: ${{ inputs.api_url }}
        APP_TOKEN: ${{ inputs.app_token }}
        PORTAL_URL: ${{ inputs.portal_url }}
        SCAN_ID: ${{ inputs.scan_id }}
        DEBUG: ${{ inputs.debug }}
        TEST_MODE: ${{ inputs.test_mode }}
        GITHUB_TOKEN: ${{ github.token }}
